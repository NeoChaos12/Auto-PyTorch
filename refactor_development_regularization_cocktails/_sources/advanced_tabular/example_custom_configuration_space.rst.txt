
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "advanced_tabular/example_custom_configuration_space.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_advanced_tabular_example_custom_configuration_space.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_advanced_tabular_example_custom_configuration_space.py:


======================
Tabular Classification with Custom Configuration Space
======================

The following example shows how adjust the configuration space of
the search. Currently, there are two changes that can be made to the space:-
1. Adjust individual hyperparameters in the pipeline
2. Include or exclude components:
    a) include: Dictionary containing components to include. Key is the node
                name and Value is an Iterable of the names of the components
                to include. Only these components will be present in the
                search space.
    b) exclude: Dictionary containing components to exclude. Key is the node
                name and Value is an Iterable of the names of the components
                to exclude. All except these components will be present in
                the search space.

.. GENERATED FROM PYTHON SOURCE LINES 19-133




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    <smac.runhistory.runhistory.RunHistory object at 0x7f99c9e8ab80> [TrajEntry(train_perf=2147483648, incumbent_id=1, incumbent=Configuration:
      data_loader:batch_size, Value: 32
      encoder:__choice__, Value: 'OneHotEncoder'
      feature_preprocessor:__choice__, Value: 'NoFeaturePreprocessor'
      imputer:categorical_strategy, Value: 'most_frequent'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:ReduceLROnPlateau:factor, Value: 0.1
      lr_scheduler:ReduceLROnPlateau:mode, Value: 'min'
      lr_scheduler:ReduceLROnPlateau:patience, Value: 10
      lr_scheduler:__choice__, Value: 'ReduceLROnPlateau'
      network_backbone:MLPBackbone:activation, Value: 'relu'
      network_backbone:MLPBackbone:num_groups, Value: 5
      network_backbone:MLPBackbone:num_units_1, Value: 200
      network_backbone:MLPBackbone:num_units_2, Value: 200
      network_backbone:MLPBackbone:num_units_3, Value: 200
      network_backbone:MLPBackbone:num_units_4, Value: 200
      network_backbone:MLPBackbone:num_units_5, Value: 200
      network_backbone:MLPBackbone:use_dropout, Value: False
      network_backbone:__choice__, Value: 'MLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'relu'
      network_head:fully_connected:num_layers, Value: 2
      network_head:fully_connected:units_layer_1, Value: 128
      network_init:XavierInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'XavierInit'
      optimizer:AdamOptimizer:beta1, Value: 0.9
      optimizer:AdamOptimizer:beta2, Value: 0.9
      optimizer:AdamOptimizer:lr, Value: 0.01
      optimizer:AdamOptimizer:use_weight_decay, Value: True
      optimizer:AdamOptimizer:weight_decay, Value: 0.0001
      optimizer:__choice__, Value: 'AdamOptimizer'
      scaler:__choice__, Value: 'StandardScaler'
      trainer:StandardTrainer:Lookahead:la_alpha, Value: 0.6
      trainer:StandardTrainer:Lookahead:la_steps, Value: 6
      trainer:StandardTrainer:se_lastk, Constant: 3
      trainer:StandardTrainer:use_lookahead_optimizer, Value: True
      trainer:StandardTrainer:use_snapshot_ensemble, Value: True
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: True
      trainer:StandardTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=0, ta_time_used=0.0, wallclock_time=0.002270221710205078, budget=0), TrajEntry(train_perf=1.0, incumbent_id=1, incumbent=Configuration:
      data_loader:batch_size, Value: 32
      encoder:__choice__, Value: 'OneHotEncoder'
      feature_preprocessor:__choice__, Value: 'NoFeaturePreprocessor'
      imputer:categorical_strategy, Value: 'most_frequent'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:ReduceLROnPlateau:factor, Value: 0.1
      lr_scheduler:ReduceLROnPlateau:mode, Value: 'min'
      lr_scheduler:ReduceLROnPlateau:patience, Value: 10
      lr_scheduler:__choice__, Value: 'ReduceLROnPlateau'
      network_backbone:MLPBackbone:activation, Value: 'relu'
      network_backbone:MLPBackbone:num_groups, Value: 5
      network_backbone:MLPBackbone:num_units_1, Value: 200
      network_backbone:MLPBackbone:num_units_2, Value: 200
      network_backbone:MLPBackbone:num_units_3, Value: 200
      network_backbone:MLPBackbone:num_units_4, Value: 200
      network_backbone:MLPBackbone:num_units_5, Value: 200
      network_backbone:MLPBackbone:use_dropout, Value: False
      network_backbone:__choice__, Value: 'MLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'relu'
      network_head:fully_connected:num_layers, Value: 2
      network_head:fully_connected:units_layer_1, Value: 128
      network_init:XavierInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'XavierInit'
      optimizer:AdamOptimizer:beta1, Value: 0.9
      optimizer:AdamOptimizer:beta2, Value: 0.9
      optimizer:AdamOptimizer:lr, Value: 0.01
      optimizer:AdamOptimizer:use_weight_decay, Value: True
      optimizer:AdamOptimizer:weight_decay, Value: 0.0001
      optimizer:__choice__, Value: 'AdamOptimizer'
      scaler:__choice__, Value: 'StandardScaler'
      trainer:StandardTrainer:Lookahead:la_alpha, Value: 0.6
      trainer:StandardTrainer:Lookahead:la_steps, Value: 6
      trainer:StandardTrainer:se_lastk, Constant: 3
      trainer:StandardTrainer:use_lookahead_optimizer, Value: True
      trainer:StandardTrainer:use_snapshot_ensemble, Value: True
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: True
      trainer:StandardTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=1, ta_time_used=3.5969576835632324, wallclock_time=4.035202264785767, budget=5.555555555555555), TrajEntry(train_perf=1.0, incumbent_id=2, incumbent=Configuration:
      data_loader:batch_size, Value: 411
      encoder:__choice__, Value: 'OneHotEncoder'
      feature_preprocessor:__choice__, Value: 'NoFeaturePreprocessor'
      imputer:categorical_strategy, Value: 'constant_!missing!'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:ReduceLROnPlateau:factor, Value: 0.8576644063694023
      lr_scheduler:ReduceLROnPlateau:mode, Value: 'min'
      lr_scheduler:ReduceLROnPlateau:patience, Value: 9
      lr_scheduler:__choice__, Value: 'ReduceLROnPlateau'
      network_backbone:MLPBackbone:activation, Value: 'tanh'
      network_backbone:MLPBackbone:dropout_1, Value: 0.5517285698137822
      network_backbone:MLPBackbone:dropout_2, Value: 0.07834564912417355
      network_backbone:MLPBackbone:dropout_3, Value: 0.39772649602336574
      network_backbone:MLPBackbone:num_groups, Value: 3
      network_backbone:MLPBackbone:num_units_1, Value: 263
      network_backbone:MLPBackbone:num_units_2, Value: 543
      network_backbone:MLPBackbone:num_units_3, Value: 42
      network_backbone:MLPBackbone:use_dropout, Value: True
      network_backbone:__choice__, Value: 'MLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:num_layers, Value: 1
      network_init:NoInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'NoInit'
      optimizer:AdamOptimizer:beta1, Value: 0.8706731286988251
      optimizer:AdamOptimizer:beta2, Value: 0.9567305969567339
      optimizer:AdamOptimizer:lr, Value: 1.2195200266594025e-05
      optimizer:AdamOptimizer:use_weight_decay, Value: True
      optimizer:AdamOptimizer:weight_decay, Value: 0.0008173627227207923
      optimizer:__choice__, Value: 'AdamOptimizer'
      scaler:__choice__, Value: 'NoScaler'
      trainer:MixUpTrainer:alpha, Value: 0.24906837334614917
      trainer:MixUpTrainer:use_lookahead_optimizer, Value: False
      trainer:MixUpTrainer:use_snapshot_ensemble, Value: False
      trainer:MixUpTrainer:use_stochastic_weight_averaging, Value: False
      trainer:MixUpTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'MixUpTrainer'
    , ta_runs=10, ta_time_used=38.743067026138306, wallclock_time=58.98760199546814, budget=16.666666666666664), TrajEntry(train_perf=1.0, incumbent_id=3, incumbent=Configuration:
      data_loader:batch_size, Value: 152
      encoder:__choice__, Value: 'OneHotEncoder'
      feature_preprocessor:PolynomialFeatures:degree, Value: 3
      feature_preprocessor:PolynomialFeatures:include_bias, Value: True
      feature_preprocessor:PolynomialFeatures:interaction_only, Value: True
      feature_preprocessor:__choice__, Value: 'PolynomialFeatures'
      imputer:categorical_strategy, Value: 'constant_!missing!'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:CyclicLR:base_lr, Value: 0.07369356930820864
      lr_scheduler:CyclicLR:max_lr, Value: 0.0675592550119432
      lr_scheduler:CyclicLR:mode, Value: 'triangular'
      lr_scheduler:CyclicLR:step_size_up, Value: 2684
      lr_scheduler:__choice__, Value: 'CyclicLR'
      network_backbone:ResNetBackbone:activation, Value: 'tanh'
      network_backbone:ResNetBackbone:blocks_per_group_0, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_1, Value: 3
      network_backbone:ResNetBackbone:blocks_per_group_2, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_3, Value: 3
      network_backbone:ResNetBackbone:blocks_per_group_4, Value: 2
      network_backbone:ResNetBackbone:num_groups, Value: 4
      network_backbone:ResNetBackbone:num_units_0, Value: 55
      network_backbone:ResNetBackbone:num_units_1, Value: 727
      network_backbone:ResNetBackbone:num_units_2, Value: 390
      network_backbone:ResNetBackbone:num_units_3, Value: 163
      network_backbone:ResNetBackbone:num_units_4, Value: 59
      network_backbone:ResNetBackbone:use_batch_norm, Value: True
      network_backbone:ResNetBackbone:use_dropout, Value: False
      network_backbone:ResNetBackbone:use_skip_connection, Value: False
      network_backbone:__choice__, Value: 'ResNetBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'sigmoid'
      network_head:fully_connected:num_layers, Value: 4
      network_head:fully_connected:units_layer_1, Value: 94
      network_head:fully_connected:units_layer_2, Value: 311
      network_head:fully_connected:units_layer_3, Value: 206
      network_init:OrthogonalInit:bias_strategy, Value: 'Zero'
      network_init:__choice__, Value: 'OrthogonalInit'
      optimizer:SGDOptimizer:lr, Value: 4.2516689351942876e-05
      optimizer:SGDOptimizer:momentum, Value: 0.9829887533028301
      optimizer:SGDOptimizer:use_weight_decay, Value: True
      optimizer:SGDOptimizer:weight_decay, Value: 7.169477949088893e-05
      optimizer:__choice__, Value: 'SGDOptimizer'
      scaler:__choice__, Value: 'MinMaxScaler'
      trainer:MixUpTrainer:alpha, Value: 0.18361885085600094
      trainer:MixUpTrainer:se_lastk, Constant: 3
      trainer:MixUpTrainer:use_lookahead_optimizer, Value: False
      trainer:MixUpTrainer:use_snapshot_ensemble, Value: True
      trainer:MixUpTrainer:use_stochastic_weight_averaging, Value: True
      trainer:MixUpTrainer:weighted_loss, Value: False
      trainer:__choice__, Value: 'MixUpTrainer'
    , ta_runs=13, ta_time_used=61.852572202682495, wallclock_time=100.40852308273315, budget=50.0)]
    {'accuracy': 0.861271676300578}
    |    | Preprocessing   | Estimator            |   Weight |
    |---:|:----------------|:---------------------|---------:|
    |  0 | None            | CatBoostClassifier   |     0.26 |
    |  1 | None            | RFClassifier         |     0.24 |
    |  2 | None            | ExtraTreesClassifier |     0.24 |
    |  3 | None            | KNNClassifier        |     0.14 |
    |  4 | None            | LGBMClassifier       |     0.1  |
    |  5 | None            | SVC                  |     0.02 |
    <smac.runhistory.runhistory.RunHistory object at 0x7f99c9cfe7f0> [TrajEntry(train_perf=2147483648, incumbent_id=1, incumbent=Configuration:
      data_loader:batch_size, Value: 32
      encoder:__choice__, Value: 'NoEncoder'
      feature_preprocessor:__choice__, Value: 'NoFeaturePreprocessor'
      imputer:categorical_strategy, Value: 'most_frequent'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:ReduceLROnPlateau:factor, Value: 0.1
      lr_scheduler:ReduceLROnPlateau:mode, Value: 'min'
      lr_scheduler:ReduceLROnPlateau:patience, Value: 10
      lr_scheduler:__choice__, Value: 'ReduceLROnPlateau'
      network_backbone:ShapedMLPBackbone:activation, Value: 'relu'
      network_backbone:ShapedMLPBackbone:max_units, Value: 200
      network_backbone:ShapedMLPBackbone:mlp_shape, Value: 'funnel'
      network_backbone:ShapedMLPBackbone:num_groups, Value: 5
      network_backbone:ShapedMLPBackbone:output_dim, Value: 200
      network_backbone:ShapedMLPBackbone:use_dropout, Value: False
      network_backbone:__choice__, Value: 'ShapedMLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'relu'
      network_head:fully_connected:num_layers, Value: 2
      network_head:fully_connected:units_layer_1, Value: 128
      network_init:XavierInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'XavierInit'
      optimizer:AdamOptimizer:beta1, Value: 0.9
      optimizer:AdamOptimizer:beta2, Value: 0.9
      optimizer:AdamOptimizer:lr, Value: 0.01
      optimizer:AdamOptimizer:use_weight_decay, Value: True
      optimizer:AdamOptimizer:weight_decay, Value: 0.0001
      optimizer:__choice__, Value: 'AdamOptimizer'
      scaler:__choice__, Value: 'StandardScaler'
      trainer:StandardTrainer:Lookahead:la_alpha, Value: 0.6
      trainer:StandardTrainer:Lookahead:la_steps, Value: 6
      trainer:StandardTrainer:se_lastk, Constant: 3
      trainer:StandardTrainer:use_lookahead_optimizer, Value: True
      trainer:StandardTrainer:use_snapshot_ensemble, Value: True
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: True
      trainer:StandardTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=0, ta_time_used=0.0, wallclock_time=0.0016782283782958984, budget=0), TrajEntry(train_perf=1.0, incumbent_id=1, incumbent=Configuration:
      data_loader:batch_size, Value: 32
      encoder:__choice__, Value: 'NoEncoder'
      feature_preprocessor:__choice__, Value: 'NoFeaturePreprocessor'
      imputer:categorical_strategy, Value: 'most_frequent'
      imputer:numerical_strategy, Value: 'mean'
      lr_scheduler:ReduceLROnPlateau:factor, Value: 0.1
      lr_scheduler:ReduceLROnPlateau:mode, Value: 'min'
      lr_scheduler:ReduceLROnPlateau:patience, Value: 10
      lr_scheduler:__choice__, Value: 'ReduceLROnPlateau'
      network_backbone:ShapedMLPBackbone:activation, Value: 'relu'
      network_backbone:ShapedMLPBackbone:max_units, Value: 200
      network_backbone:ShapedMLPBackbone:mlp_shape, Value: 'funnel'
      network_backbone:ShapedMLPBackbone:num_groups, Value: 5
      network_backbone:ShapedMLPBackbone:output_dim, Value: 200
      network_backbone:ShapedMLPBackbone:use_dropout, Value: False
      network_backbone:__choice__, Value: 'ShapedMLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'relu'
      network_head:fully_connected:num_layers, Value: 2
      network_head:fully_connected:units_layer_1, Value: 128
      network_init:XavierInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'XavierInit'
      optimizer:AdamOptimizer:beta1, Value: 0.9
      optimizer:AdamOptimizer:beta2, Value: 0.9
      optimizer:AdamOptimizer:lr, Value: 0.01
      optimizer:AdamOptimizer:use_weight_decay, Value: True
      optimizer:AdamOptimizer:weight_decay, Value: 0.0001
      optimizer:__choice__, Value: 'AdamOptimizer'
      scaler:__choice__, Value: 'StandardScaler'
      trainer:StandardTrainer:Lookahead:la_alpha, Value: 0.6
      trainer:StandardTrainer:Lookahead:la_steps, Value: 6
      trainer:StandardTrainer:se_lastk, Constant: 3
      trainer:StandardTrainer:use_lookahead_optimizer, Value: True
      trainer:StandardTrainer:use_snapshot_ensemble, Value: True
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: True
      trainer:StandardTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=1, ta_time_used=3.555431604385376, wallclock_time=4.0910868644714355, budget=5.555555555555555), TrajEntry(train_perf=1.0, incumbent_id=2, incumbent=Configuration:
      data_loader:batch_size, Value: 509
      encoder:__choice__, Value: 'NoEncoder'
      feature_preprocessor:PowerTransformer:standardize, Value: True
      feature_preprocessor:__choice__, Value: 'PowerTransformer'
      imputer:categorical_strategy, Value: 'most_frequent'
      imputer:numerical_strategy, Value: 'most_frequent'
      lr_scheduler:CosineAnnealingLR:T_max, Value: 52
      lr_scheduler:__choice__, Value: 'CosineAnnealingLR'
      network_backbone:ResNetBackbone:activation, Value: 'tanh'
      network_backbone:ResNetBackbone:blocks_per_group_0, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_1, Value: 4
      network_backbone:ResNetBackbone:blocks_per_group_10, Value: 2
      network_backbone:ResNetBackbone:blocks_per_group_11, Value: 4
      network_backbone:ResNetBackbone:blocks_per_group_12, Value: 4
      network_backbone:ResNetBackbone:blocks_per_group_13, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_14, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_15, Value: 2
      network_backbone:ResNetBackbone:blocks_per_group_2, Value: 2
      network_backbone:ResNetBackbone:blocks_per_group_3, Value: 1
      network_backbone:ResNetBackbone:blocks_per_group_4, Value: 4
      network_backbone:ResNetBackbone:blocks_per_group_5, Value: 2
      network_backbone:ResNetBackbone:blocks_per_group_6, Value: 4
      network_backbone:ResNetBackbone:blocks_per_group_7, Value: 3
      network_backbone:ResNetBackbone:blocks_per_group_8, Value: 3
      network_backbone:ResNetBackbone:blocks_per_group_9, Value: 2
      network_backbone:ResNetBackbone:dropout_0, Value: 0.1783096837286463
      network_backbone:ResNetBackbone:dropout_1, Value: 0.09528211950060239
      network_backbone:ResNetBackbone:dropout_10, Value: 0.3138580194339611
      network_backbone:ResNetBackbone:dropout_11, Value: 0.17859025202503376
      network_backbone:ResNetBackbone:dropout_12, Value: 0.4017288035775709
      network_backbone:ResNetBackbone:dropout_13, Value: 0.33566695085522846
      network_backbone:ResNetBackbone:dropout_14, Value: 0.4854335852228187
      network_backbone:ResNetBackbone:dropout_15, Value: 0.21731208101507177
      network_backbone:ResNetBackbone:dropout_2, Value: 0.04057888295554807
      network_backbone:ResNetBackbone:dropout_3, Value: 0.09283992445059769
      network_backbone:ResNetBackbone:dropout_4, Value: 0.1590040767343856
      network_backbone:ResNetBackbone:dropout_5, Value: 0.18392077713114147
      network_backbone:ResNetBackbone:dropout_6, Value: 0.4803449442142782
      network_backbone:ResNetBackbone:dropout_7, Value: 0.23284545501555598
      network_backbone:ResNetBackbone:dropout_8, Value: 0.266791186050791
      network_backbone:ResNetBackbone:dropout_9, Value: 0.242693511272702
      network_backbone:ResNetBackbone:mb_choice, Value: 'None'
      network_backbone:ResNetBackbone:num_groups, Value: 15
      network_backbone:ResNetBackbone:num_units_0, Value: 13
      network_backbone:ResNetBackbone:num_units_1, Value: 990
      network_backbone:ResNetBackbone:num_units_10, Value: 437
      network_backbone:ResNetBackbone:num_units_11, Value: 867
      network_backbone:ResNetBackbone:num_units_12, Value: 13
      network_backbone:ResNetBackbone:num_units_13, Value: 288
      network_backbone:ResNetBackbone:num_units_14, Value: 31
      network_backbone:ResNetBackbone:num_units_15, Value: 85
      network_backbone:ResNetBackbone:num_units_2, Value: 57
      network_backbone:ResNetBackbone:num_units_3, Value: 34
      network_backbone:ResNetBackbone:num_units_4, Value: 163
      network_backbone:ResNetBackbone:num_units_5, Value: 708
      network_backbone:ResNetBackbone:num_units_6, Value: 115
      network_backbone:ResNetBackbone:num_units_7, Value: 11
      network_backbone:ResNetBackbone:num_units_8, Value: 510
      network_backbone:ResNetBackbone:num_units_9, Value: 46
      network_backbone:ResNetBackbone:use_batch_norm, Value: False
      network_backbone:ResNetBackbone:use_dropout, Value: True
      network_backbone:ResNetBackbone:use_skip_connection, Value: True
      network_backbone:__choice__, Value: 'ResNetBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'tanh'
      network_head:fully_connected:num_layers, Value: 4
      network_head:fully_connected:units_layer_1, Value: 462
      network_head:fully_connected:units_layer_2, Value: 364
      network_head:fully_connected:units_layer_3, Value: 128
      network_init:SparseInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'SparseInit'
      optimizer:SGDOptimizer:lr, Value: 0.003222498432241572
      optimizer:SGDOptimizer:momentum, Value: 0.8259925004475608
      optimizer:SGDOptimizer:use_weight_decay, Value: False
      optimizer:__choice__, Value: 'SGDOptimizer'
      scaler:__choice__, Value: 'StandardScaler'
      trainer:StandardTrainer:Lookahead:la_alpha, Value: 0.7587718610537026
      trainer:StandardTrainer:Lookahead:la_steps, Value: 10
      trainer:StandardTrainer:use_lookahead_optimizer, Value: True
      trainer:StandardTrainer:use_snapshot_ensemble, Value: False
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: False
      trainer:StandardTrainer:weighted_loss, Value: True
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=10, ta_time_used=47.10585927963257, wallclock_time=62.4278883934021, budget=16.666666666666664), TrajEntry(train_perf=1.0, incumbent_id=3, incumbent=Configuration:
      data_loader:batch_size, Value: 172
      encoder:__choice__, Value: 'NoEncoder'
      feature_preprocessor:PolynomialFeatures:degree, Value: 3
      feature_preprocessor:PolynomialFeatures:include_bias, Value: True
      feature_preprocessor:PolynomialFeatures:interaction_only, Value: True
      feature_preprocessor:__choice__, Value: 'PolynomialFeatures'
      imputer:categorical_strategy, Value: 'constant_!missing!'
      imputer:numerical_strategy, Value: 'constant_zero'
      lr_scheduler:CosineAnnealingWarmRestarts:n_restarts, Value: 4
      lr_scheduler:__choice__, Value: 'CosineAnnealingWarmRestarts'
      network_backbone:ShapedMLPBackbone:activation, Value: 'sigmoid'
      network_backbone:ShapedMLPBackbone:max_dropout, Value: 0.5260557982550567
      network_backbone:ShapedMLPBackbone:max_units, Value: 355
      network_backbone:ShapedMLPBackbone:mlp_shape, Value: 'long_funnel'
      network_backbone:ShapedMLPBackbone:num_groups, Value: 3
      network_backbone:ShapedMLPBackbone:output_dim, Value: 50
      network_backbone:ShapedMLPBackbone:use_dropout, Value: True
      network_backbone:__choice__, Value: 'ShapedMLPBackbone'
      network_embedding:__choice__, Value: 'NoEmbedding'
      network_head:__choice__, Value: 'fully_connected'
      network_head:fully_connected:activation, Value: 'sigmoid'
      network_head:fully_connected:num_layers, Value: 2
      network_head:fully_connected:units_layer_1, Value: 120
      network_init:XavierInit:bias_strategy, Value: 'Normal'
      network_init:__choice__, Value: 'XavierInit'
      optimizer:RMSpropOptimizer:alpha, Value: 0.8893366595157555
      optimizer:RMSpropOptimizer:lr, Value: 2.3892765068892517e-05
      optimizer:RMSpropOptimizer:momentum, Value: 0.6227177944703447
      optimizer:RMSpropOptimizer:use_weight_decay, Value: True
      optimizer:RMSpropOptimizer:weight_decay, Value: 1.6459065493395435e-06
      optimizer:__choice__, Value: 'RMSpropOptimizer'
      scaler:Normalizer:norm, Value: 'mean_abs'
      scaler:__choice__, Value: 'Normalizer'
      trainer:StandardTrainer:use_lookahead_optimizer, Value: False
      trainer:StandardTrainer:use_snapshot_ensemble, Value: False
      trainer:StandardTrainer:use_stochastic_weight_averaging, Value: True
      trainer:StandardTrainer:weighted_loss, Value: False
      trainer:__choice__, Value: 'StandardTrainer'
    , ta_runs=13, ta_time_used=62.49276113510132, wallclock_time=95.62987685203552, budget=50.0)]
    {'accuracy': 0.884393063583815}
    |    | Preprocessing   | Estimator            |   Weight |
    |---:|:----------------|:---------------------|---------:|
    |  0 | None            | ExtraTreesClassifier |     0.44 |
    |  1 | None            | CatBoostClassifier   |     0.36 |
    |  2 | None            | KNNClassifier        |     0.16 |
    |  3 | None            | RFClassifier         |     0.04 |






|

.. code-block:: default

    import os
    import tempfile as tmp
    import warnings

    os.environ['JOBLIB_TEMP_FOLDER'] = tmp.gettempdir()
    os.environ['OMP_NUM_THREADS'] = '1'
    os.environ['OPENBLAS_NUM_THREADS'] = '1'
    os.environ['MKL_NUM_THREADS'] = '1'

    warnings.simplefilter(action='ignore', category=UserWarning)
    warnings.simplefilter(action='ignore', category=FutureWarning)

    import sklearn.datasets
    import sklearn.model_selection

    from autoPyTorch.api.tabular_classification import TabularClassificationTask
    from autoPyTorch.utils.hyperparameter_search_space_update import HyperparameterSearchSpaceUpdates


    def get_search_space_updates():
        """
        Search space updates to the task can be added using HyperparameterSearchSpaceUpdates
        Returns:
            HyperparameterSearchSpaceUpdates
        """
        updates = HyperparameterSearchSpaceUpdates()
        updates.append(node_name="data_loader",
                       hyperparameter="batch_size",
                       value_range=[16, 512],
                       default_value=32)
        updates.append(node_name="lr_scheduler",
                       hyperparameter="CosineAnnealingLR:T_max",
                       value_range=[50, 60],
                       default_value=55)
        updates.append(node_name='network_backbone',
                       hyperparameter='ResNetBackbone:dropout',
                       value_range=[0, 0.5],
                       default_value=0.2)
        return updates


    if __name__ == '__main__':

        ############################################################################
        # Data Loading
        # ============
        X, y = sklearn.datasets.fetch_openml(data_id=40981, return_X_y=True, as_frame=True)
        X_train, X_test, y_train, y_test = sklearn.model_selection.train_test_split(
            X,
            y,
            random_state=1,
        )

        ############################################################################
        # Build and fit a classifier with include components
        # ==================================================
        api = TabularClassificationTask(
            search_space_updates=get_search_space_updates(),
            include_components={'network_backbone': ['MLPBackbone', 'ResNetBackbone'],
                                'encoder': ['OneHotEncoder']}
        )

        ############################################################################
        # Search for an ensemble of machine learning algorithms
        # =====================================================
        api.search(
            X_train=X_train.copy(),
            y_train=y_train.copy(),
            X_test=X_test.copy(),
            y_test=y_test.copy(),
            optimize_metric='accuracy',
            total_walltime_limit=300,
            func_eval_time_limit_secs=50
        )

        ############################################################################
        # Print the final ensemble performance
        # ====================================
        print(api.run_history, api.trajectory)
        y_pred = api.predict(X_test)
        score = api.score(y_pred, y_test)
        print(score)
        print(api.show_models())

        ############################################################################
        # Build and fit a classifier with exclude components
        # ==================================================
        api = TabularClassificationTask(
            search_space_updates=get_search_space_updates(),
            exclude_components={'network_backbone': ['MLPBackbone'],
                                'encoder': ['OneHotEncoder']}
        )

        ############################################################################
        # Search for an ensemble of machine learning algorithms
        # =====================================================
        api.search(
            X_train=X_train,
            y_train=y_train,
            X_test=X_test.copy(),
            y_test=y_test.copy(),
            optimize_metric='accuracy',
            total_walltime_limit=300,
            func_eval_time_limit_secs=50
        )

        ############################################################################
        # Print the final ensemble performance
        # ====================================
        print(api.run_history, api.trajectory)
        y_pred = api.predict(X_test)
        score = api.score(y_pred, y_test)
        print(score)
        print(api.show_models())


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 11 minutes  36.697 seconds)


.. _sphx_glr_download_advanced_tabular_example_custom_configuration_space.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example


  .. container:: binder-badge

    .. image:: images/binder_badge_logo.svg
      :target: https://mybinder.org/v2/gh/automl/Auto-PyTorch/refactor_development?urlpath=lab/tree/notebooks/advanced_tabular/example_custom_configuration_space.ipynb
      :alt: Launch binder
      :width: 150 px


  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: example_custom_configuration_space.py <example_custom_configuration_space.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: example_custom_configuration_space.ipynb <example_custom_configuration_space.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
